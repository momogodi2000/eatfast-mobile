# Flutter Mobile Development Environment
FROM ubuntu:22.04

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    git \
    unzip \
    xz-utils \
    zip \
    libglu1-mesa \
    openjdk-11-jdk \
    wget \
    && rm -rf /var/lib/apt/lists/*

# Set JAVA_HOME
ENV JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64

# Install Flutter
RUN git clone https://github.com/flutter/flutter.git /flutter
ENV PATH="$PATH:/flutter/bin"

# Pre-download Flutter dependencies
RUN flutter doctor
RUN flutter precache

# Install Android SDK
RUN wget -q https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O android-sdk.zip && \
    unzip android-sdk.zip && \
    mkdir -p /android-sdk/cmdline-tools && \
    mv cmdline-tools /android-sdk/cmdline-tools/latest && \
    rm android-sdk.zip

ENV ANDROID_HOME=/android-sdk
ENV PATH="$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools"

# Accept Android SDK licenses
RUN yes | sdkmanager --licenses
RUN sdkmanager "platform-tools" "platforms;android-33" "build-tools;33.0.0"

# Set working directory
WORKDIR /app

# Copy Flutter project
COPY . .

# Get Flutter dependencies
RUN flutter pub get

# Enable web and mobile platforms
RUN flutter config --enable-web
RUN flutter config --enable-linux-desktop

# Expose ports
EXPOSE 3000 8080

# Development command
CMD ["flutter", "run", "-d", "web-server", "--web-hostname", "0.0.0.0", "--web-port", "3000"]
